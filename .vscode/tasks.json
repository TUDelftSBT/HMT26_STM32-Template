{
    "version": "2.0.0",
    "tasks": [
        {
            "label": "Rebuild & Reopen Dev Container",
            "type": "shell",
            "command": "${command:remote-containers.rebuildAndReopenInContainer}",
            // Cannot remove as it will ask for more steps, hence defeating the workflow.
            "problemMatcher": [],
            "dependsOn": [
                "Attach USB port"
            ]
        },
        {
            "label": "Attach USB port",
            "type": "shell",
            "command": "", //TODO fix this for linux.
            "windows": {
                "command": ".\\scripts\\host-windows\\usb\\usb-passthrough-attach.bat",
            },
            "problemMatcher": []
        },

        {
            "label": "Pre-compile",
            "hide": true,
            "type": "shell",
            "command": "./scripts/build-scripts/pre-build.sh",
        },
        {
            "label": "Build Project",
            "type": "cmake",
            "command": "build",
            "group": "build",
            "problemMatcher": [],
            // TODO: build in release when you want to foil
            "detail": "CMake build task",
            "dependsOn" : ["Pre-compile"],
            "dependsOrder": "sequence",
        },
        {
            "label": "Post-compile",
            "type": "shell",
            "command": "./scripts/build-scripts/post-build.sh",
            "dependsOn" : ["Build Project"]
        },
        {
            "label": "Flash using OpenOCD",
            "type": "shell",
            "command": "openocd -f openocd.cfg",
            "group": {
                "kind": "build",
                "isDefault": true
            },
            "dependsOn" : ["Post-compile"],
            "dependsOrder": "sequence",
        },
        {
            "label": "Build and Test",
            "type": "shell",
            "command": "./scripts/dev-container/tests/run-tests.sh",
            "options": {
                "cwd": "${workspaceFolder}"
            },
            "group": {
                "kind": "test",
                "isDefault": true
            },
        }
    ],
}